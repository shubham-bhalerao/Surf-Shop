<% layout('layouts/boilerplate') -%>
<h1>Posts Index</h1>
<div id="map"></div>
<div style="margin:20px 0">
   <% if(posts.page-1){ %>
   <a href="/posts?page=<%=posts.page-1%>">Prev</a>
   <% } %>
   <% for(let i=1;i<=posts.pages;i++){ %>
   <a href="/posts?page=<%=i%>" <%= i === posts.page ? "style=color:#000" : '' %>><%=i%></a>
   <% } %>
   <% if( posts.page + 1 <=posts.pages){ %>
   <a href="/posts?page=<%=posts.page+1%>">Next</a>
   <% } %>
</div>
<% posts.docs.forEach(function(post){ %>
<div>
   <h2>
      <%=post.title%>
   </h2>
   <p>
      <%=post.price%>
   </p>
   <p>
      <%=post.description%>
   </p>
   <p>
      <a href="/posts/<%=post._id%>">View More</a>
   </p>
</div>
<% })%>

<script>
   mapboxgl.accessToken = "<%=mapboxToken%>";
   var posts = {
      features: <%-JSON.stringify(posts.docs)%>
   };
</script>
<script src="/js/allPostsClusterMap.js"></script>